---

title: TabNet functionality

keywords: fastai
sidebar: home_sidebar

summary: "Integrating TabNet with fastai."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabNet" class="doc_header"><code>class</code> <code>TabNet</code><a href="https://github.com/mgrankin/fast_tabnet/tree/master/fast_tabnet/core.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabNet</code>(<strong><code>input_dim</code></strong>, <strong><code>output_dim</code></strong>, <strong><code>n_d</code></strong>=<em><code>8</code></em>, <strong><code>n_a</code></strong>=<em><code>8</code></em>, <strong><code>n_steps</code></strong>=<em><code>3</code></em>, <strong><code>gamma</code></strong>=<em><code>1.3</code></em>, <strong><code>n_independent</code></strong>=<em><code>2</code></em>, <strong><code>n_shared</code></strong>=<em><code>2</code></em>, <strong><code>epsilon</code></strong>=<em><code>1e-15</code></em>, <strong><code>virtual_batch_size</code></strong>=<em><code>128</code></em>, <strong><code>momentum</code></strong>=<em><code>0.02</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in
a tree structure. You can assign the submodules as regular attributes::</p>

<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super(Model, self).__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))

</code></pre>
<p>Submodules assigned in this way will be registered, and will have their
parameters converted too when you call :meth:<code>to</code>, etc.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TabNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines TabNet network</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    - input_dim : int</span>
<span class="sd">        Initial number of features</span>
<span class="sd">    - output_dim : int</span>
<span class="sd">        Dimension of network output</span>
<span class="sd">        examples : one for regression, 2 for binary classification etc...</span>
<span class="sd">    - n_d : int</span>
<span class="sd">        Dimension of the prediction  layer (usually between 4 and 64)</span>
<span class="sd">    - n_a : int</span>
<span class="sd">        Dimension of the attention  layer (usually between 4 and 64)</span>
<span class="sd">    - n_steps: int</span>
<span class="sd">        Number of sucessive steps in the newtork (usually betwenn 3 and 10)</span>
<span class="sd">    - gamma : float</span>
<span class="sd">        Float above 1, scaling factor for attention updates (usually betwenn 1.0 to 2.0)</span>
<span class="sd">    - momentum : float</span>
<span class="sd">        Float value between 0 and 1 which will be used for momentum in all batch norm</span>
<span class="sd">    - n_independent : int</span>
<span class="sd">        Number of independent GLU layer in each GLU block (default 2)</span>
<span class="sd">    - n_shared : int</span>
<span class="sd">        Number of independent GLU layer in each GLU block (default 2)</span>
<span class="sd">    - epsilon: float</span>
<span class="sd">        Avoid log(0), this should be kept very low</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> 
                 <span class="n">n_d</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_a</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">n_steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> 
                 <span class="n">n_independent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_shared</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                 <span class="n">virtual_batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.02</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TabNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dim</span> <span class="o">=</span> <span class="n">output_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_d</span> <span class="o">=</span> <span class="n">n_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_a</span> <span class="o">=</span> <span class="n">n_a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">n_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_independent</span> <span class="o">=</span> <span class="n">n_independent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_shared</span> <span class="o">=</span> <span class="n">n_shared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtual_batch_size</span> <span class="o">=</span> <span class="n">virtual_batch_size</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shared</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">shared_feat_transform</span> <span class="o">=</span> <span class="n">GLU_Block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span>
                                              <span class="n">n_d</span><span class="o">+</span><span class="n">n_a</span><span class="p">,</span>
                                              <span class="n">n_glu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_shared</span><span class="p">,</span>
                                              <span class="n">virtual_batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virtual_batch_size</span><span class="p">,</span>
                                              <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shared_feat_transform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_splitter</span> <span class="o">=</span> <span class="n">FeatTransformer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">n_d</span><span class="o">+</span><span class="n">n_a</span><span class="p">,</span> <span class="n">shared_feat_transform</span><span class="p">,</span>
                                                <span class="n">n_glu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_independent</span><span class="p">,</span>
                                                <span class="n">virtual_batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virtual_batch_size</span><span class="p">,</span>
                                                <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">feat_transformers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">att_transformers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">transformer</span> <span class="o">=</span> <span class="n">FeatTransformer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">n_d</span><span class="o">+</span><span class="n">n_a</span><span class="p">,</span> <span class="n">shared_feat_transform</span><span class="p">,</span>
                                          <span class="n">n_glu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_independent</span><span class="p">,</span>
                                          <span class="n">virtual_batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virtual_batch_size</span><span class="p">,</span>
                                          <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
            <span class="n">attention</span> <span class="o">=</span> <span class="n">AttentiveTransformer</span><span class="p">(</span><span class="n">n_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span>
                                             <span class="n">virtual_batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virtual_batch_size</span><span class="p">,</span>
                                             <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feat_transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">att_transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attention</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_mapping</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_d</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">initialize_non_glu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_mapping</span><span class="p">,</span> <span class="n">n_d</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">prior</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">att</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_splitter</span><span class="p">(</span><span class="n">x</span><span class="p">)[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_d</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att_transformers</span><span class="p">[</span><span class="n">step</span><span class="p">](</span><span class="n">prior</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
            <span class="c1"># update prior</span>
            <span class="n">prior</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">-</span> <span class="n">M</span><span class="p">,</span> <span class="n">prior</span><span class="p">)</span>
            <span class="c1"># output</span>
            <span class="n">masked_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feat_transformers</span><span class="p">[</span><span class="n">step</span><span class="p">](</span><span class="n">masked_x</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_d</span><span class="p">])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="c1"># explain</span>
            <span class="n">step_importance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># update attention</span>
            <span class="n">att</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_d</span><span class="p">:]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_mapping</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabNetModel" class="doc_header"><code>class</code> <code>TabNetModel</code><a href="https://github.com/mgrankin/fast_tabnet/tree/master/fast_tabnet/core.py#L139" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabNetModel</code>(<strong><code>emb_szs</code></strong>, <strong><code>n_cont</code></strong>, <strong><code>out_sz</code></strong>, <strong><code>embed_p</code></strong>=<em><code>0.0</code></em>, <strong><code>y_range</code></strong>=<em><code>None</code></em>, <strong><code>n_d</code></strong>=<em><code>8</code></em>, <strong><code>n_a</code></strong>=<em><code>8</code></em>, <strong><code>n_steps</code></strong>=<em><code>3</code></em>, <strong><code>gamma</code></strong>=<em><code>1.3</code></em>, <strong><code>n_independent</code></strong>=<em><code>2</code></em>, <strong><code>n_shared</code></strong>=<em><code>2</code></em>, <strong><code>epsilon</code></strong>=<em><code>1e-15</code></em>, <strong><code>virtual_batch_size</code></strong>=<em><code>128</code></em>, <strong><code>momentum</code></strong>=<em><code>0.02</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Attention model for tabular data.</p>

</div>

</div>

</div>
</div>

</div>
</div>
 

